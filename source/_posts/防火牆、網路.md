---
title: 防火牆、網路
date: 2018-06-27 09:51:15
tags:
---

###防火牆、網路入門介紹

### 一、防火牆

### 一個專案開啟後會有預設防火牆，但是 IP 跟目標都是全開是不安全的，所以我們要做防火牆的修改，或是建立新的防火牆

### 先進入 VPC 網路 → 防火牆規則

![ ](images/1.png)

### 點選建立防火牆規則，或是直接修改預設防火牆也可以 ( 點選名稱直接進入編輯 )

![ ](images/2.png)

### 此畫面是建立畫面，這次只介紹比較常用到的選項

![ ](images/3.1.png)

### 1. 填寫名稱 ( 命名隨意 )：英文小寫不能有空格，說明 ( 選填 )：就是註解

![ ](images/4.png)

### 2. 優先等級：防火牆優先順序 0 到 65535 預設 1000，點擊藍色字可以檢查其他防火牆順序

![ ](images/5.png)
![ ](images/6.1.png)

### 3. 有分輸入 ( 從外部輸入到 VM ) 跟輸出 ( VM 輸出到外部 ) 方向，設定基本一樣本章就都已輸入為基準

![ ](images/52.png)

### 4. 目標：有三個選項本章只介紹常用的前 2 個選項 ( 服務帳戶有機會會再做一邊文章介紹 )

![ ](images/7.png)

### 網路中的所有執行個體：只要在專案下 VM 都會套用

![ ](images/8.png)

### 指定的目標標記：在目標代碼設定一個目標代碼 ( 名稱隨意 )，設定目標代碼後只會讓設定同樣代碼 VM ( 在 VM 叫網路標記 ) 使用此防火牆

![ ](images/9.png)

### VM 設目標的地放在設定管理、磁碟、網路、SSH 金鑰 → 網路 → 網路標記，記得標記 2 邊 ( 防火牆和 VM ) 都要設定一樣

### 如果 VM 建好到編輯裡面更改即可

![ ](images/51.png)

### 5. 來源 IP 範圍：輸入需要連線的 IP 0.0.0.0/0 是 IP 全開，但不建議這樣做

![ ](images/12.png)

### 6. 通訊協定和通訊埠：開啟需要的埠，有2個選項全開和指定埠號 ( 但不建議全開 )

![ ](images/13.png)

### 埠是有格式：基本格式 tcp/udp:( 要開的埠號 )，使用 - 可以開範圍埠號，使用 ; 連開埠號

### ex：tcp:22

### ex：udp:5000-6000

### ex：tcp:22;udp:5000-6000

![ ](images/14.png)

### 建立好畫面，剛剛選擇的設定上面都會看的到

![ ](images/15.1.png)

### 也可以點擊名稱可以進入查看更詳細的防火牆資訊，點擊編輯可以再做修改

![ ](images/17.png)

### 7. 停用防火牆：把因為各種原因使用的防火牆停止使用，等待下次使用就不需要在重建了

![ ](images/53.png)

### 停用防火牆如圖所示 ( 以建立防火牆進入編輯停用即可 )

![ ](images/54.png)

### 舉例：設定 SSH 連線防火牆 ( SSH 連線使用的 tcp 是 22 )

### 設定目標代碼後只會讓設定同樣代碼 VM 使用此防火牆，設定 IP 跟埠號使特定 IP 才可以連線

### 如圖只有使用 test 標記的 VM 可以使用此防火牆，然後只有 117.165.197.21 這個 IP 可以使用 SSH 連線 ( tcp:22 )

![ ](images/16.png)

### 補充：在建立 VM 的時候會有防火牆 HTTP 和 HTTPS 讓你打勾

![ ](images/18.png)

### VM 打勾建立好會在防火牆幫你建2個防火牆出來，但是 IP 是全開標記也幫你設定好，需要再做修改

![ ](images/19.png)

### 恭喜防火牆建立完成！

***

### 二、網路

### VM 建立網路部分如果不設定預設是動態 IP，每次重開機 IP 都會換一組，本篇文章將教學如何設定成固定 IP

### 1. 內部 IP 設定：內部 IP 設定有2種方式

### (1) 在開 VM 時建立好，或已經建好 VM 到 VM 裡面再做編輯

### 建 VM 時下方管理、硬碟、網路、SSH金鑰選擇網路，點筆圖案會多出一些選項可以設定

![ ](images/21.png)
![ ](images/22.1.png)

### 點選主要內部 IP 右邊 ▼，選擇預約靜態內部 IP 位址

![ ](images/23.png)

### 出現預約靜態內部 IP 位址畫面，輸入名稱跟說明，靜態 IP 位址選擇自動指派

![ ](images/24.png)

### 也可以選擇自行選擇，自訂 IP 位址內有告訴你範圍，但是建議自動指派就好

![ ](images/25.png)

### IP 範圍是固定的，是跟著區域走的

![ ](images/26.png)

### 如果建立 VM 沒設定到，可以到 VM 執行個體 → 點擊 VM 名稱觀看詳細資料 → 點擊編輯修改

![ ](images/33.png)
![ ](images/34.png)

### PS：改回臨時會釋放 IP

![ ](images/35.png)

### (2) 從另一個地方建立 VPC網路 → VPC網路

![ ](images/55.png)

### 進入畫面後，點擊名稱下的 default 進入 VPC 網路詳細資料

![ ](images/56.png)

### 再點擊下方分頁靜態內部 IP 位址

![ ](images/57.png)

### 接下來點擊預約靜態網址預約網址，方式跟上面一樣

![ ](images/58.png)

### 比較不一樣的是子網路沒有固定區域，要在自己選擇跟 VM 相同區域

![ ](images/59.png)

### 完成畫面

![ ](images/60.png)

### 2. 外部 IP 設定：外部 IP 設定有 2 種方法

### (1) 在開 VM 時建立好，或已經建好 VM 到 VM 裡面再做編輯

### 建 VM 時下方管理、硬碟、網路、SSH金鑰選擇網路，點筆圖案會多出一些選項可以設定

![ ](images/21.png)
![ ](images/61.png)

### 點選外部 IP 右邊 ▼，選擇建立 IP 位址

![ ](images/27.png)

### 出現預約新的靜態 IP 位址畫面，輸入名稱跟說明，網路服務級別進階，標準如圖說明目前只有三個區域有

### PS：進階是走 Google 的海底纜線，標準走的是網際網路會強制使用 IPv4

![ ](images/28.png)

### 設定好畫面

![ ](images/29.png)

### 可以進入 VM 查看剛剛設定網路訊息

![ ](images/30.png)

### 如果建立 VM 沒設定到，可以到 VM 執行個體 → 點擊 VM 名稱觀看詳細資料 → 點擊編輯修改

![ ](images/39.png)

### 如果有建立多組 IP 可以隨時做更換

![ ](images/41.png)
![ ](images/42.png)
![ ](images/43.png)

### 更改回臨時 IP 還是會存在，要到 VPC 網路 → 外部 IP 位址，釋放 IP

![ ](images/66.png)
![ ](images/67.png)

### (2) 從另一個地方建立 VPC 網路 → 外部 IP 位址

![ ](images/31.png)

### 已經建立好 VM 但沒設定靜態 IP 進入時會看到下圖畫面類型會顯示臨時

![ ](images/62.png)

### 點擊臨時旁的 ▼ 會出現選項選擇靜態

![ ](images/63.png)

### 命名點擊預約，成功後前方名稱會更改為你命的名稱，類型更改為靜態就是成功了

![ ](images/64.png)
![ ](images/65.png)

### 點選預約靜態 IP ( 沒有建立 VM 和 IP 會出現下圖 ) 位址建立 IP

![ ](images/32.png)

### 有建立 VM 或 IP 點上面預約靜態位址

![ ](images/36.png)

### 出現預約靜態位址畫面，設定名稱跟說明其他預設，區域選擇跟 VM 同區域 "連接到：" 選擇要改固定 IP 的 VM 名稱

![ ](images/37.png)

### 標準目前只有三個區域有 ( 進階是走 Google 的海底纜線，標準走的是網際網路會強制使用 IPv4 )

![ ](images/38.png)

### 建立好畫面，點選你命名的名稱就可以直接進入 VM 執行個體詳細資料

![ ](images/40.png)

### 也可以先設定一組沒使用者的外部 IP，"連接到："不設定 VM 名稱使用者會出現無

![ ](images/48.png)

### 點選變更改成要的 VM 就可以把固定 IP 設定過去

![ ](images/49.png)

### 使用者彙編更成你設定的 VM 名稱

![ ](images/50.png)

### 最後記得砍掉 VM，IP 還是會在，如果不需要要釋放掉

![ ](images/44.png)

### 恭喜 IP 設定完成！